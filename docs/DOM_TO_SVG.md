# DOM to SVG 功能使用文档

## 📖 功能概述

DOM to SVG 是一个开发者工具，允许你在开发模式下选择页面中的任意 DOM 元素并将其导出为 SVG 矢量图形文件。这对于创建设计文档、UI 截图、技术文档插图等场景非常有用。

## ✨ 核心特性

- 🎯 **可视化元素选择** - 实时高亮显示悬停的元素
- ⌨️ **键盘导航** - 使用方向键在 DOM 树中上下导航
- 📊 **元素信息显示** - 显示选择器、尺寸、标签等详细信息
- 💾 **SVG 导出** - 将选中元素导出为高质量 SVG 文件
- 🔒 **开发专用** - 仅在开发模式下可用，生产环境自动隐藏

## 🚀 快速开始

### 启动开发环境

```bash
# 启动开发服务器
pnpm tauri dev
```

启动后，你会在应用右下角看到一个圆形浮动按钮（眼睛图标）。

### 基本使用流程

1. **打开工具**
   - 点击右下角的浮动按钮（眼睛图标 🔍）
   - 控制面板将在右下角展开

2. **开始选择**
   - 点击 "开始选择元素" 按钮
   - 页面进入选择模式，出现半透明覆盖层

3. **浏览元素**
   - 移动鼠标，蓝色高亮框将跟随显示当前悬停的元素
   - 顶部提示框显示元素的选择器（如 `div.container.flex`）

4. **调整选择范围**
   - 按 `↑` (上箭头) 键 - 向上选择父元素
   - 按 `↓` (下箭头) 键 - 向下选择子元素
   - 继续调整直到高亮框覆盖你想要的区域

5. **确认选择**
   - 按 `Enter` 键，或直接点击鼠标
   - 蓝色高亮框变为绿色，表示已选中
   - 控制面板显示元素详细信息

6. **导出 SVG**
   - 点击 "导出 SVG" 按钮
   - 选择保存位置和文件名
   - 完成导出

## 🎮 操作指南

### 键盘快捷键

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `↑` | 选择父元素 | 在 DOM 树中向上一层 |
| `↓` | 选择子元素 | 在 DOM 树中向下一层（第一个子元素） |
| `Enter` | 确认选择 | 选中当前高亮的元素 |
| `ESC` | 取消选择 | 退出选择模式 |

### 鼠标操作

| 操作 | 功能 |
|------|------|
| 移动鼠标 | 浏览页面元素，实时显示高亮 |
| 点击 | 确认选择当前高亮的元素 |
| 点击控制面板 | 不会触发选择，可安全操作 |

### 视觉反馈

| 颜色 | 含义 |
|------|------|
| 🔵 **蓝色高亮** | 当前悬停或导航到的元素 |
| 🟢 **绿色高亮** | 已确认选中的元素 |
| ⚫ **半透明覆盖** | 选择模式激活中 |

## 📋 使用场景

### 1. 导出整个页面布局

```
操作步骤：
1. 鼠标移动到页面任意位置
2. 按住 ↑ 键多次，向上导航到根容器
3. 确认高亮框覆盖整个页面
4. 按 Enter 或点击确认
5. 导出 SVG
```

### 2. 导出特定组件

```
操作步骤：
1. 鼠标悬停到组件内部的某个元素
2. 按 ↑ 键向上导航，直到高亮框覆盖整个组件
3. 确认选择并导出
```

### 3. 导出精确的小元素

```
操作步骤：
1. 直接将鼠标移动到目标元素上
2. 确认蓝色高亮框准确覆盖
3. 点击或按 Enter 确认
4. 导出 SVG
```

### 4. 导出按钮、卡片等 UI 元素

```
操作步骤：
1. 鼠标悬停到 UI 元素上
2. 使用 ↑↓ 键微调选择范围
3. 确保包含完整的样式和内容
4. 导出 SVG
```

## 🔧 技术细节

### 依赖库

- **html-to-image** (v1.11.13) - DOM 到图像转换核心库
- **@tauri-apps/plugin-dialog** - 文件保存对话框
- **@tauri-apps/plugin-fs** - 文件系统写入

### 文件结构

```
src/
├── components/
│   └── devtools/
│       ├── ElementSelector.tsx        # 元素选择器主组件
│       ├── DevToolsFloatingButton.tsx # 浮动触发按钮
│       └── DevToolsDebug.tsx          # 调试组件（已移除）
├── store/
│   └── devtoolsStore.ts               # DevTools 状态管理
└── components/layout/
    └── MainLayout.tsx                 # 集成位置
```

### 环境检测

工具使用 Vite 的环境变量进行环境检测：

```typescript
const isDevelopment = import.meta.env.DEV;
```

- **开发环境** (`pnpm tauri dev`) - 功能可用
- **生产环境** (`pnpm tauri build`) - 功能完全隐藏，不打包

### SVG 导出参数

```typescript
htmlToImage.toSvg(element, {
  cacheBust: true,    // 禁用缓存，确保最新样式
  pixelRatio: 2,      // 2倍分辨率，提高清晰度
});
```

### 支持的编码格式

导出功能自动检测并处理三种 SVG 数据格式：

1. **Base64 编码** - `data:image/svg+xml;base64,`
2. **UTF-8 URL 编码** - `data:image/svg+xml;charset=utf-8,`
3. **未编码** - `data:image/svg+xml,`

## ⚠️ 注意事项

### 导出限制

1. **样式依赖**
   - 导出的 SVG 包含内联样式
   - 外部 CSS 文件中的样式会被计算后内联
   - 动态样式（如 hover）不会被导出

2. **图片资源**
   - 背景图片会被转换为 Data URL 嵌入
   - 大量图片可能导致 SVG 文件过大
   - 建议选择包含少量图片的元素

3. **字体处理**
   - 使用系统字体的文本可以正常导出
   - 自定义 Web 字体需要确保已加载完成
   - 建议在字体加载后再导出

4. **动画和交互**
   - CSS 动画不会被导出
   - JavaScript 交互效果不会保留
   - 导出的是静态快照

5. **DevTools UI 自动过滤**
   - ✅ 导出时自动隐藏浮动按钮和控制面板
   - ✅ 导出时自动过滤高亮框和提示框
   - ✅ 确保导出的 SVG 不包含任何 DevTools 元素
   - ℹ️ 这个过程是自动的，无需手动操作

### 性能考虑

1. **元素大小**
   - 选择整个页面可能导致导出时间较长
   - 建议分块导出大型页面
   - 复杂元素（大量子元素）会增加处理时间

2. **内存使用**
   - 大型元素导出会占用较多内存
   - 建议关闭其他占用内存的应用
   - 如果导出失败，尝试选择更小的范围

### 最佳实践

1. **选择合适的范围**
   - 只选择需要的部分，避免不必要的内容
   - 确保选中的元素包含完整的边框和阴影
   - 检查高亮框是否完整覆盖目标区域

2. **检查导出结果**
   - 使用浏览器或 SVG 编辑器预览导出的文件
   - 确认样式、布局、文字都正确显示
   - 必要时调整选择范围重新导出

3. **文件命名**
   - 使用描述性的文件名，如 `button-primary-hover.svg`
   - 包含日期或版本号，如 `dashboard-layout-2024-01-26.svg`
   - 便于后续管理和查找

## 🐛 故障排查

### 问题：点击无反应

**解决方法：**
- 检查是否点击了控制面板（控制面板不会触发选择）
- 确保已点击"开始选择元素"按钮
- 查看浏览器控制台是否有错误日志

### 问题：无法选择父元素

**解决方法：**
- 确保先用鼠标悬停到某个元素上
- 再按 ↑ 键向上导航
- 如果已到达最顶层，继续按 ↑ 无效果

### 问题：导出的 SVG 样式不正确

**解决方法：**
- 等待页面完全加载（包括字体、图片）
- 确保目标元素在可视区域内
- 检查是否有外部样式未加载

### 问题：导出失败 (atob 错误)

**解决方法：**
- 这个问题已在最新版本中修复
- 如果仍然出现，请查看控制台日志
- 尝试选择更小的元素范围

### 问题：高亮框位置不准确

**解决方法：**
- 滚动页面后位置可能偏移
- 重新开始选择流程
- 确保浏览器窗口大小未改变

## 📊 元素信息说明

控制面板显示的元素信息包括：

### 选择器 (Selector)
- 格式：`标签名#id.class1.class2...`
- 示例：`div#app.container.flex.items-center`
- 最多显示 3 个 class，超出显示 `...`

### 尺寸 (Size)
- 格式：`宽度 × 高度` (单位：像素)
- 示例：`1280 × 720`
- 基于元素的 `getBoundingClientRect()`

### 标签 (Tag)
- HTML 标签名（小写）
- 示例：`div`, `button`, `section`

## 🎨 导出的 SVG 特点

### 优点
- ✅ 矢量格式，可无损缩放
- ✅ 文件相对较小（纯文本格式）
- ✅ 可在浏览器、设计工具中直接打开
- ✅ 保留文本可选择性
- ✅ 支持透明背景

### 局限
- ❌ 不包含交互效果
- ❌ 不包含动画
- ❌ 大量图片会增加文件大小
- ❌ 某些复杂 CSS 效果可能失真

## 💡 高级技巧

### 1. 快速选择技巧

```
技巧：使用"二分法"快速定位
1. 鼠标移动到目标区域中心
2. 按 ↑ 键向上导航几次
3. 如果高亮框太大，按 ↓ 键回退
4. 反复调整直到精确覆盖目标
```

### 2. 批量导出工作流

```
工作流程：
1. 创建一个导出文件夹
2. 为每个要导出的组件命名规则（如：component-name.svg）
3. 依次选择并导出，使用一致的命名
4. 使用版本控制管理导出的 SVG 文件
```

### 3. 与设计工具集成

```
建议流程：
1. 使用 DOM to SVG 导出初始设计
2. 在 Figma/Sketch 中导入 SVG
3. 进行细节调整和优化
4. 导出为其他格式（PNG、PDF 等）
```

## 🔍 调试模式

如果需要查看详细的调试信息，可以打开浏览器开发者工具（F12），查看 Console 标签的日志输出。

## 📚 相关资源

- [html-to-image 文档](https://github.com/bubkoo/html-to-image)
- [Tauri 插件文档](https://tauri.app/v1/guides/features/command)
- [SVG 规范](https://www.w3.org/Graphics/SVG/)

## 🤝 贡献

如果发现问题或有改进建议：

1. 在项目中创建 Issue
2. 描述问题或建议的功能
3. 如有可能，提供复现步骤或代码示例

## 📝 更新日志

### v1.0.2 (2024-01-26)

**优化改进：**
- 🎨 使用 Toast 消息替代 Alert 弹窗，提升用户体验
- 🧹 移除调试日志，优化代码可读性
- 🐛 修复导出成功后页面遮罩未清除的问题
- 🐛 修复元素恢复时的 insertBefore 错误

### v1.0.1 (2024-01-26)

**Bug 修复：**
- 🐛 修复导出整个应用时包含 DevTools UI 元素的问题
- 🐛 导出时自动隐藏浮动按钮和控制面板
- 🐛 使用 filter 函数过滤 DevTools 相关元素

### v1.0.0 (2024-01-26)

**新增功能：**
- ✨ 初始版本发布
- ✨ 支持元素选择和 SVG 导出
- ✨ 支持键盘导航（↑↓ 键）
- ✨ 支持多种 SVG 编码格式
- ✨ 添加实时高亮和提示信息

**Bug 修复：**
- 🐛 修复 className.split 错误
- 🐛 修复 atob 解码失败问题
- 🐛 修复键盘导航后点击选择错误元素的问题

---

**最后更新时间：** 2024 年 1 月 26 日  
**版本：** 1.0.2  
**维护者：** SSH Terminal 开发团队
