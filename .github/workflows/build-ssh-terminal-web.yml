name: Build SSH Terminal Web

on:
    push:
        tags:
            - "v*"
    workflow_dispatch:
        inputs:
            build:
                description: "Build SSH Terminal Web"
                required: false
                default: true
                type: boolean

jobs:
    build-web:
        if: github.event_name == 'push' || inputs.build == true
        runs-on: ubuntu-latest
        defaults:
            run:
                working-directory: ./ssh-terminal-web
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Setup pnpm
              uses: pnpm/action-setup@v4

            - name: Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: "20"

            - name: Install dependencies
              run: pnpm install

            - name: Type check
              run: pnpm type-check

            - name: Build
              run: pnpm build

            - name: Upload build artifacts
              uses: actions/upload-artifact@v4
              with:
                  name: ssh-terminal-web-dist
                  path: ./ssh-terminal-web/dist
                  retention-days: 30

            - name: Archive build artifacts
              run: |
                  cd dist
                  tar -czf ../ssh-terminal-web-dist.tar.gz .
                  cd ..

            - name: Upload archived artifacts
              uses: actions/upload-artifact@v4
              with:
                  name: ssh-terminal-web-dist-archive
                  path: ./ssh-terminal-web/ssh-terminal-web-dist.tar.gz
                  retention-days: 30